<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Go Mazes</title>
    <style>
        th {
            border-style: none;
            background-color: white;
            border-width: thick;
        }
        .b-t {
            border-top-style: solid;
        }
        .b-b {
            border-bottom-style: solid;
        }
        .b-r {
            border-right-style:solid;
        }
        .b-l {
            border-left-style: solid;
        }
        .c-search {
            background-color: lightblue;
        }
        .c-solution {
            background-color: green;
        }
        .c-goal {
            background-color: yellow;
        }
    </style>

    <script>
        let tickSpeed = {{ .TickSpeed }};
        let stepsFull = {{ .MPath }} ;
        let bestSteps = {{ .MBestPath }} ;
        let repeats = {{ .PathRepeats }}

        const timer = ms => new Promise(res => setTimeout(res, ms))

        window.addEventListener("load", async function () {
            //set the maze to draw asynchronously
            await drawAllPaths();
            await timer(1000);
            await drawBestPath();
        });

        async function drawAllPaths(){
            const promises = stepsFull.map(async step => {
                await drawMaze(step, "c-search", 0, 0, repeats);
            })
            await Promise.all(promises);
        }

        async function drawBestPath() {
            await drawMaze(bestSteps, "c-solution", 1, 0, repeats);
        }

        async function drawMaze(steps, color, startOffset, endOffset, repeats){
            for (let i = startOffset; i < steps.length-endOffset; i++) {
                for (let j = 0; j < repeats; j++) {
                    if(i < steps.length-endOffset) {
                        getObjFromCoords(steps, i).classList.add(color);
                        i++;
                    }
                }
                i--;
                await timer(tickSpeed);
            }
        }

        function getObjFromCoords(steps, index){
            let row = steps[index][0];
            let col = steps[index][1];

            let maze = document.getElementById("maze");
            //Pick the first row
            let r = maze.firstElementChild.firstElementChild;
            //Step to the correct row
            for (let i = 0; i < row; i++){
                r = r.nextElementSibling;
            }
            //Pick the first column
            let node = r.firstElementChild;
            //step to the correct column
            for (let i = 0; i < col; i++){
                node = node.nextElementSibling;
            }
            return node;
        }

    </script>
</head>
<body>
    <table style="border-collapse: collapse" id="maze">
        {{ range .MStyles }}<tr>
            {{ range . }}<th class="{{.}}">     </th>
            {{ end }}
        </tr>
        {{ end }}
    </table>
</body>
</html>
