<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Go Mazes</title>

    <script>
        let tickSpeed = {{ .TickSpeed }};
        let stepsFull = {{ .MPath }} ;
        let bestSteps = {{ .MBestPath }} ;

        const timer = ms => new Promise(res => setTimeout(res, ms))

        window.addEventListener("load", async function () {
            //set the maze to draw asynchronously
            await drawAllPaths();
            await timer(1000);
            await drawBestPath();
        });

        async function drawAllPaths(){
            const promises = stepsFull.map(async step => {
                await drawMaze(step, "lightblue", 0, 1);
            })
            await Promise.all(promises);
        }

        async function drawBestPath() {
            await drawMaze(bestSteps, "green", 1, 0);
        }

        async function drawMaze(steps, color, startOffset, endOffset) {
            for (let i = startOffset; i < steps.length-endOffset; i++) {
                let node = getObjFromCoords(steps, i);
                node.style.backgroundColor = color;
                await timer(tickSpeed);
            }
        }

        function getObjFromCoords(steps, index){
            let row = steps[index][0];
            let col = steps[index][1];

            let maze = document.getElementById("maze");
            //Pick the first row
            let r = maze.firstElementChild.firstElementChild;
            //Step to the correct row
            for (let i = 0; i < row; i++){
                r = r.nextElementSibling;
            }
            //Pick the first column
            let node = r.firstElementChild;
            //step to the correct column
            for (let i = 0; i < col; i++){
                node = node.nextElementSibling;
            }
            return node;
        }

    </script>
</head>
<body>
    <table style="border-collapse: collapse" id="maze">
        {{ range .MStyles }}<tr>
            {{ range . }}<th style="{{.}}">     </th>
            {{ end }}
        </tr>
        {{ end }}
    </table>
</body>
</html>
